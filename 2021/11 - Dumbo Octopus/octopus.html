<!DOCTYPE html>
<html>
    <head>
        <script src="solution.js"></script>
        <script>
            let grid, tableCells, numSteps, numStepsDiv, flashLock, prevTimestamp, animationDuration = 333;
            function runAnimation(timestamp){
                if( timestamp - prevTimestamp >= animationDuration && !flashLock ){
                    let flashers = evolve(grid);
                    for( let r = 0; r < grid.length; r++ ){
                        for( let c = 0; c < grid[0].length; c++ ){
                            let td = tableCells[r][c];
                            td.classList.replace( td.classList.item(1), "energy" + grid[r][c]);
                        }
                    }
                    flashLock = flashers.length;
                    flashers.forEach( ([ r, c]) => {
                        tableCells[r][c].onanimationend = function(){
                            this.onanimationend = undefined;
                            flashLock--;
                        };
                    });
                    numStepsDiv.innerText = ++numSteps;
                    prevTimestamp = timestamp;
                }
                requestAnimationFrame(runAnimation);
            }
            window.onload = function(){
                numSteps = 0;
                flashLock = 0;
                prevTimestamp = 0;
                numStepsDiv = document.getElementById("steps");
                if( location.hash ){
                    let size = location.hash.slice(1) >>> 0 || 10;
                    grid = Array.from( new Array(size), () => Array.from( new Array(size), () => Math.random()*8+1>>>0));
                }
                else{
                    grid = document.getElementById("input").innerText.trim().split(/\s+/).map( x => x.split("").map(Number));
                }
                let sheet = document.head.appendChild(document.createElement("style")).sheet;
                sheet.insertRule(`td.octopus { width: ${80/grid.length}vmin; height: ${80/grid[0].length}vmin; }`);
                sheet.insertRule(`td.octopus.energy0::after{ animation-duration: ${animationDuration}ms; }`);
                let seafloor = document.getElementById("seafloor");
                seafloor.innerHTML = "";
                tableCells = grid.map( row => {
                    let tr = seafloor.appendChild(document.createElement("tr"));
                    return row.map( () => tr.appendChild(document.createElement("td")));
                });
                tableCells.forEach( row => row.forEach( td => td.classList.add("octopus","energy1")));
                requestAnimationFrame(runAnimation);
            };
            window.onhashchange = window.onload;
        </script>
        <style>
            * {
                margin: 0px;
                padding: 0px;
            }
            body {
                align-items: center;
                background-color: #0e1f31;
                display: flex;
                flex-direction: column;
                height: 100vh;
                justify-content: center;
                overflow: hidden;
            }
            #input {
                display: none;
            }
            #steps {
                color: white;
                font-family: monospace;
                font-weight: bold;
                padding-bottom: 2em;
            }
            #steps::before{
                content: "# STEPS:";
                padding-right: 0.5em;
            }
            table {
                border-collapse: collapse;
            }
            td.octopus {
                background: no-repeat center/ 100% 100% url(octopus.png);
                position: relative;
            }
            td.octopus.energy1 { opacity:  33% }
            td.octopus.energy2 { opacity:  40% }
            td.octopus.energy3 { opacity:  48% }
            td.octopus.energy4 { opacity:  55% }
            td.octopus.energy5 { opacity:  63% }
            td.octopus.energy6 { opacity:  70% }
            td.octopus.energy7 { opacity:  78% }
            td.octopus.energy8 { opacity:  85% }
            td.octopus.energy9 { opacity:  93% }
            td.octopus.energy0 { opacity: 100% }
            td.octopus::after {
                background: radial-gradient( #ff7fbf 0%, transparent 70%);
                content: "";
                display: block;
                position: absolute;
            }
            td.octopus.energy0::after{
                animation: glow 1 ease-out;
            }
            @keyframes glow{
                  0% {width:   0%; height:   0%; top: 50%; left: 50%; }
                 33% {width: 100%; height: 100%; top:  0%; left:  0%; }
                100% {width:   0%; height:   0%; top: 50%; left: 50%; }
            }
        </style>
    </head>
    <body>
        <div id="input">
        <!-- paste input here -->
            3113284886
            2851876144
            2774664484
            6715112578
            7146272153
            6256656367
            3148666245
            3857446528
            7322422833
            8152175168
        </div>
        <div id="steps"></div>
        <table id="seafloor"></table>
    </body>
</html>

