#!/usr/bin/perl -ap
$C{$_}++for split"",$F[0];%C=push@H,join"",(sort{$b-$a}values%C),$F[0]=~y/KAT/RUB/r,"!"x$F[1]}{$\+=++$i*y/!/!/for sort@H